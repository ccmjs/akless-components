(()=>{const component={name:"quiz",ccm:"https://ccmjs.github.io/ccm/versions/ccm-26.1.1.js",config:{css:["ccm.load","https://ccmjs.github.io/akless-components/quiz/resources/default.css"],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-7.0.0.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/quiz/resources/templates-v2.html"],placeholder:{prefix:"Question",cancel:"Cancel",prev:"Previous",submit:"Submit",next:"Next",correct:"Correct solution: ",finish:"Finish"},progress_bar:true,questions:[{text:"First Question",input:"radio",answers:[{text:"Answer A",correct:true},{text:"Answer B"}]}]},Instance:function(){const self=this;let $,results;this.init=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);$.use(this.ccm);evaluateLightDOM();function evaluateLightDOM(){if(!self.inner)return;const questions=[];[...self.inner.children].forEach(question_tag=>{if(question_tag.tagName!=="QUESTION")return;const question=$.generateConfig(question_tag);question.answers=[];[...question.inner.children].forEach(answer_tag=>{if(answer_tag.tagName!=="ANSWER")return;const answer=$.generateConfig(answer_tag);delete answer.inner;question.answers.push(answer)});delete question.inner;question.answers.length>0&&questions.push(question)});if(questions.length>0)self.questions=questions}});this.ready=(async()=>{await uniformData();if(self.show_results){self.start_button=false;self.cancel_button=false;self.navigation=true;self.feedback=true;self.shuffle=false;self.time=false;self.questions.forEach(question=>question.random=false);self.anytime_finish=true;self.onfinish=null}self.logger&&self.logger.log("ready",$.privatize(self,true));async function uniformData(){await $.asyncForEach(self.questions,async(question,i)=>{question.nr=i+1;question.id="question-"+question.nr;self.questions[i]=question=await $.integrate($.filterProperties(self,"text","description","answers","input","attributes","swap","escape","random","solution"),question,true);if(!question.input)question.input="checkbox";if(!question.solution&&question.input!=="radio")question.solution=[];for(i=0;i<question.answers.length;i++)if(!$.isObject(question.answers[i]))question.answers[i]={text:question.answers[i]};if(question.input==="checkbox"&&typeof question.solution[0]==="number"){const solution=[];for(i=0;i<question.answers.length;i++)solution.push(question.solution.indexOf(i)>=0);question.solution=solution}if(Array.isArray(question.solution))for(i=0;i<question.answers.length;i++)if(question.solution[i]===undefined)question.solution[i]=question.input==="checkbox"?false:"";await $.asyncForEach(question.answers,async(answer,i)=>{answer.nr=i+1;answer.class="answer-"+answer.nr;answer.id=question.id+"-"+answer.class;if(answer.correct!==undefined)if(question.input==="radio"){if(answer.correct===true)question.solution=i}else question.solution[i]=question.input==="number"?parseInt(answer.correct):answer.correct;question.answers[i]=await $.integrate($.filterProperties(question,"attributes","swap","escape"),answer,true)});delete question.attributes;delete question.swap});delete self.text;delete self.description;delete self.answers;delete self.input;delete self.attributes;delete self.swap;delete self.escape;delete self.random;delete self.solution}});this.start=(async()=>{results={sections:[],correct:0,total:self.questions.length};self.logger&&self.logger.log("render");if(self.start_button)$.setContent(self.element,$.html(self.html.start,start));else await start();async function start(){const dataset=await $.dataset(self.data);let current_question=0;const evaluated={};self.logger&&self.logger.log("start",$.clone(dataset));$.setContent(self.element,$.html(self.html.main));const cancel_elem=self.element.querySelector("#cancel");const prev_elem=self.element.querySelector("#prev");const next_elem=self.element.querySelector("#next");const submit_elem=self.element.querySelector("#submit");const finish_elem=self.element.querySelector("#finish");const timer_elem=self.element.querySelector("#timer");if(!self.cancel_button)$.remove(cancel_elem);if(!self.navigation)$.remove(prev_elem);if(!self.feedback)$.remove(submit_elem);if(self.questions.length===1){$.remove(prev_elem);$.remove(next_elem)}self.shuffle&&$.shuffleArray(self.questions);self.questions.forEach(renderQuestion);showQuestion();self.show_results&&evaluate();renderTimer();self.onstart&&self.onstart(self);function renderQuestion(question,i){question.i=i;question.elem=$.html(self.html.question,{id:question.id,nr:i+1,count:self.questions.length,text:question.escape?$.escapeHTML(question.text):question.text,description:question.description,prefix:self.placeholder.prefix});!question.description&&$.remove(question.elem.querySelector(".description"));question.random&&$.shuffleArray(question.answers);question.answers.forEach(renderAnswer);self.element.querySelector("#questions").appendChild(question.elem);function renderAnswer(answer){answer.elem=$.html(self.html.answer,{id:answer.id,class:answer.class,text:answer.escape?$.escapeHTML(answer.text):answer.text});addInput();question.elem.querySelector(".answers").appendChild(answer.elem);async function addInput(){let input={tag:"input",type:question.input,name:answer.id,id:answer.id+"-input",oninput:function(){onInputEvent.call(this,"input")},onchange:function(){onInputEvent.call(this,"change")}};if(dataset&&dataset.sections){if(question.input==="radio"){if(dataset.sections[question.nr-1].input===answer.nr-1)input.checked=true}else if(question.input==="checkbox"){if(dataset.sections[question.nr-1].input[answer.nr-1])input.checked=true}else input.value=dataset.sections[question.nr-1].input[answer.nr-1]}if(question.input==="radio"){input.name=question.id;input.value=answer.nr-1}input=Object.assign(input,answer.attributes);const entry_elem=answer.elem.querySelector(".entry");const input_elem=$.html({class:"input",inner:input});entry_elem.insertBefore(input_elem,entry_elem.firstChild);if(answer.swap){entry_elem.insertBefore(entry_elem.children[1],input_elem);entry_elem.classList.add("swap")}function onInputEvent(event){const event_data={question:question.nr,answer:answer.nr,value:this.value};self.logger&&self.logger.log(event,$.clone(event_data));self["on"+event]&&self["on"+event].call(self,$.clone(event_data),this)}}}}function showQuestion(){[...self.element.querySelectorAll(".question")].forEach(question_elem=>question_elem.style.display="none");self.questions[current_question].elem.style.display="block";updateButtons()}function updateButtons(){const question=self.questions[current_question];self.cancel_button&&$.setContent(cancel_elem,$.html({tag:"button",inner:self.placeholder.cancel,onclick:function(){onButtonEvent.call(this,"cancel");!self.onchange&&self.start()}}));self.navigation&&$.setContent(prev_elem,$.html({tag:"button",disabled:question.i===0,inner:self.placeholder.prev,onclick:function(){current_question--;showQuestion();onButtonEvent.call(this,"prev")}}));$.setContent(next_elem,$.html({tag:"button",disabled:question.i===self.questions.length-1||self.feedback&&!self.skippable&&!evaluated[question.nr],inner:self.placeholder.next,onclick:function(){current_question++;showQuestion();onButtonEvent.call(this,"next")}}));self.feedback&&$.setContent(submit_elem,$.html({tag:"button",disabled:evaluated[question.nr],inner:self.placeholder.submit,onclick:()=>evaluate(question)}));!self.show_results&&self.onfinish&&$.setContent(finish_elem,$.html({tag:"button",disabled:!self.anytime_finish&&(question.i!==self.questions.length-1||self.feedback&&!evaluated[question.nr]),inner:self.placeholder.finish,onclick:onFinish}));function onButtonEvent(event){const question=self.questions[current_question];const event_data={question_nr:question.i+1,original_nr:question.nr,number_of_questions:self.questions.length,results:results};self.logger&&self.logger.log(event,event_data);self["on"+event]&&self["on"+event].call(self,event_data,this)}}function evaluate(question){if(!question)return self.questions.forEach(evaluate);if(results.sections[question.nr-1])return;const event_data={question_nr:question.i+1,original_nr:question.nr,number_of_questions:self.questions.length,input:getValues()};if(self.onvalidation&&!self.onvalidation.call(self,$.clone(event_data)))return;event_data.solution=question.solution;event_data.correct=event_data.input!==""&&event_data.input!==false&&JSON.stringify(event_data.input)===JSON.stringify(event_data.solution);event_data.correct&&results.correct++;self.feedback&&self.logger&&self.logger.log("feedback",$.clone(event_data));delete event_data.number_of_questions;results.sections[question.nr-1]=event_data;[...question.elem.querySelectorAll("input")].forEach(input_field=>input_field.disabled=true);self.feedback&&showFeedback();evaluated[question.nr]=true;self.feedback&&self.onfeedback&&self.onfeedback.call(self,$.clone(event_data));updateButtons();function getValues(){const values=$.formData(question.elem);if(question.input==="radio")return parseInt(values[Object.keys(values)[0]]);const array=[];for(const i in values)array[i.split("-").pop()-1]=question.input==="checkbox"?!!values[i]:values[i];return array}function showFeedback(){question.answers.forEach(answer=>{if(event_data.solution===undefined)return;if(question.input==="radio")return;const solution=event_data.solution[answer.nr-1];const input=event_data.input[answer.nr-1];input!==""&&input!==false&&input===solution&&answer.elem.classList.add("right");input!==""&&input!==false&&input!==solution&&answer.elem.classList.add("wrong");input===false&&solution!==false&&answer.elem.classList.add("correct");if(question.input!=="checkbox"&&solution!==""&&input!==solution)answer.comment=self.placeholder.correct+solution+(answer.comment?". "+answer.comment:"")});if(event_data.solution===undefined)return renderComments();if(question.input==="radio"){const solution=event_data.solution;const input=event_data.input;const id_prefix="#"+question.id+"-answer-";if(event_data.input===solution)question.elem.querySelector(id_prefix+(input+1)).classList.add("right");else{if(!isNaN(event_data.input))question.elem.querySelector(id_prefix+(input+1)).classList.add("wrong");question.elem.querySelector(id_prefix+(solution+1)).classList.add("correct")}}renderComments();function renderComments(){question.answers.forEach(answer=>{answer.comment&&$.setContent(answer.elem.querySelector(".comment"),$.html(self.html.comment,{click:function(){[...self.element.querySelectorAll(".clicked")].forEach(elem=>elem!==this&&elem.classList.remove("clicked"));this.classList.toggle("clicked");const event_data={question:question.nr,answer:answer.nr};self.logger&&self.logger.log("comment",$.clone(event_data));self.oncomment&&self.oncomment.call(self,$.clone(event_data),this)},comment:answer.escape?$.escapeHTML(answer.comment):answer.comment}))})}}}function renderTimer(){if(!self.time)return $.remove(timer_elem);let timer_value=self.time;timer();function timer(){if(!finish_elem)return;$.setContent(timer_elem,$.html(self.html.timer,timer_value));if(timer_value--)window.setTimeout(timer,1e3);else{self.logger&&self.logger.log("timeout",self.time);onFinish()}}}async function onFinish(){self.user&&await self.user.login();$.remove(finish_elem);$.remove(timer_elem);evaluate();self.logger&&self.logger.log("finish",self.getValue());self.progress_bar&&$.progressBar(self.element.querySelector("#main"),results.correct,results.total);$.onFinish(self)}}});this.getValue=(()=>$.clone(results))}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||[""])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){(c="latest"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();