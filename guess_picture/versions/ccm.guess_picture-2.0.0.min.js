(()=>{const component={name:"guess_picture",version:[2,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.5.2.js",config:{css:["ccm.load","https://ccmjs.github.io/akless-components/guess_picture/resources/styles.css"],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-5.1.0.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/guess_picture/resources/templates.html"],interval:1500,max_width:500,picture:"",size:4,solution:[]},Instance:function(){let $,results,intervalID,pictures;this.ready=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);this.logger&&this.logger.log("ready",$.privatize(this,true));pictures=$.clone(this.pictures)});this.start=(async()=>{results={correct:this.size*this.size,total:this.size*this.size-1,sections:[]};if(pictures){const i=Math.floor(Math.random()*pictures.length);this.picture=pictures[i].image;this.solution=pictures[i].solution;pictures.splice(i,1);if(!pictures.length)pictures=$.clone(this.pictures)}this.solution=this.solution.map(solution=>solution.toUpperCase().trim());this.logger&&this.logger.log("start",{picture:this.picture,solution:$.clone(this.solution),pictures:$.clone(pictures)});const finish=()=>{clearInterval(intervalID);[...this.element.querySelectorAll(".tile")].forEach(tile=>tile.classList.add("free"));this.element.querySelector("#solution input").disabled=true;if(results.points>results.total)results.points=results.total;$.append(this.element.querySelector("#main"),$.html(this.html.result,{points:results.correct,total:results.total,finish:()=>$.onFinish(this)}));if(!this.onfinish)$.remove(this.element.querySelector("#finish"));this.lang&&this.lang.translate()};$.setContent(this.element,$.html(this.html.main,{picture:this.picture,check:event=>{const value=event.target.value.toUpperCase().trim();const list=event.target.classList;list.remove("correct");list.remove("wrong");if(!value)return;const isCorrect=()=>{for(let i=0;i<this.solution.length;i++)if(value===this.solution[i])return true};if(isCorrect()){list.add("correct");finish()}else list.add("wrong")}}));if(this.lang){$.append(this.element.querySelector("#top"),this.lang.root);this.lang.start()}if(this.user)$.append(this.element.querySelector("#top"),this.user.root);if(this.max_width)this.element.querySelector("#game").style.maxWidth=this.max_width+"px";const inside=this.element.querySelector("#inside");let size="";[...Array(this.size*this.size)].forEach(()=>$.append(inside,$.html(this.html.tile)));[...Array(this.size)].forEach(()=>size+="auto ");inside.style["grid-template-columns"]=size;inside.style["grid-template-rows"]=size;const tiles=[...this.element.querySelectorAll(".tile")];intervalID=window.setInterval(()=>{if(!$.hasDomContact(this))return clearInterval(intervalID);if(!tiles.length)return finish();const i=Math.floor(Math.random()*tiles.length);tiles[i].classList.add("free");tiles.splice(i,1);results.correct--},this.interval);this.element.querySelector("#solution input").focus();this.lang&&this.lang.translate()});this.getValue=(()=>results)}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();