(()=>{const component={name:"component_manager",ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.4.0.js",config:{css:["ccm.load","https://ccmjs.github.io/akless-components/component_manager/resources/css/styles.css"],data:{},helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-5.1.0.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/component_manager/resources/templates.html"],ignore:{configs:["ccm.store"]},menu_app:["ccm.component","https://ccmjs.github.io/akless-components/menu/versions/ccm.menu-3.0.0.js",["ccm.get","https://ccmjs.github.io/akless-components/component_manager/resources/resources.js","menu_app"]],menu_top:["ccm.component","https://ccmjs.github.io/akless-components/menu/versions/ccm.menu-3.0.0.js",["ccm.get","https://ccmjs.github.io/akless-components/component_manager/resources/resources.js","menu_top"]]},Instance:function(){let $;this.ready=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);this.logger&&this.logger.log("ready",$.privatize(this,true))});this.start=(async()=>{const dataset=await $.dataset(this.data);if(!dataset||Object.keys(dataset).length<=1)return $.setContent(this.element,$.html(this.html.empty,"Component"));if(!dataset.icon)dataset.icon=this.default_icon||"";this.logger&&this.logger.log("start",$.clone(dataset));$.setContent(this.element,$.html(this.html.main,Object.assign({},dataset,{edit:async()=>{const main=this.element.querySelector("#main");$.setContent(this.element,$.html(this.html.edit,{cancel:()=>{$.setContent(this.element,main);this.logger&&this.logger.log("cancel",{store:this.data.store.source(),key:dataset.key})},del:()=>{if(!confirm("Are you sure? Metadata of the component will be deleted. Apps created from the component will still work."))return;this.data.store.del(dataset.key).then(async()=>{this.logger&&this.logger.log("delete",{dataset:$.clone(dataset),store:this.data.store.source(),key:dataset.key});this.onchange&&await this.onchange({event:"del",instance:this,dataset:$.clone(dataset),store:this.data.store.source()});await this.start()})}}));this.form.start({root:this.element.querySelector("#form"),data:{store:["ccm.store",this.data.store.source()],key:dataset.key,convert:json=>{json.demos=[];json.ignore.demos.forEach(demo=>json.demos.push({title:demo.title,app:demo.app[2][2]}));json.builders=[];json.ignore.builders.forEach(builder=>json.builders.push({title:builder.title,component:$.convertComponentURL(builder.app[1]).index,app:builder.app[2][2]}));delete json.ignore;return json}},onfinish:{convert:async json=>{json.key=$.convertComponentURL(json.path).index;json.tags=json.tags.filter(tag=>tag);json.ignore={demos:[],builders:[]};if(!json.icon)delete json.icon;this.ignore.configs&&json.demos.forEach(demo=>demo.title&&demo.app&&json.ignore.demos.push({title:demo.title,app:["ccm.instance",json.path,["ccm.get",this.ignore.configs[1],demo.app]]}));delete json.demos;this.ignore.configs&&await $.asyncForEach(json.builders,async builder=>{const component=builder.component&&await this.data.store.get(builder.component);builder.title&&component&&builder.app&&json.ignore.builders.push({title:builder.title,app:["ccm.component",component.path,["ccm.get",this.ignore.configs[1],builder.app]]})});delete json.builders;if(json.key!==dataset.key)return;return json},store:true,callback:async(results,instance)=>{this.logger&&this.logger.log("edit",{dataset:$.clone(results),store:this.data.store.source(),key:results.key});this.onchange&&await this.onchange({event:"edit",instance:this,dataset:$.clone(results),store:this.data.store.source()});await this.start()}}});this.lang&&this.lang.translate();this.logger&&this.logger.log("edit",{store:this.data.store.source(),key:dataset.key})}})));if(!dataset.icon)$.remove(this.element.querySelector("#icon"));if(!this.user||!this.user.isLoggedIn()||this.user.data().user!==dataset._.creator||!this.form)$.remove(this.element.querySelector("#edit_button"));if(this.lang){$.append(this.element.querySelector("#top"),this.lang.root);this.lang.start()}this.user&&$.append(this.element.querySelector("#top"),this.user.root);const content=this.element.querySelector("#content");const view={overview:async()=>{this.routing&&this.routing.set("overview");$.setContent(content,$.html(this.html.overview,$.clone(dataset)));if(!dataset.subject)$.remove(this.element.querySelector("#abstract"));if(!dataset.description)$.remove(this.element.querySelector("#description"));if(this.component_details)this.component_details.start({root:this.element.querySelector("#details .content"),json2json:json=>{if(!json.category)json.category="";json.tags=json.tags.join(", ");json.created_at=json.created_at?new Date(json.created_at).toLocaleString():"";return json},placeholder:$.clone(dataset)});else $.remove(this.element.querySelector("#details"));if((!dataset.ignore.demos||dataset.ignore.demos.length===0)&&this.default_demo&&dataset.category!=="Utility")dataset.ignore.demos=[{title:"Default Configuration",app:["ccm.instance",dataset.path,{key:"default"}]}];if(dataset.ignore.demos&&dataset.ignore.demos.length){let config;$.setContent(content.querySelector("#demo .content"),$.html(this.html.collection));$.append(content.querySelector("#aside"),$.html(this.html.create_similar_app,async()=>{if(!config||!content.querySelector("#app").innerHTML)return;this.ignore.create_similar_app=config;menu.select("creation")}));this.menu_app.start({root:content.querySelector("#menu-app"),data:{entries:dataset.ignore.demos.map(demo=>demo.title)},"routing.2":this.routing&&this.routing.app&&{app:this.routing.app+"_demo"},onchange:async event=>{const app_dependency=$.clone(dataset.ignore.demos[event.id-1].app);app_dependency[2]=await $.solveDependency(app_dependency[2]);config=$.clone(app_dependency[2]);app_dependency[2].parent=this;const app=await $.solveDependency(app_dependency);$.setContent(content.querySelector("#app"),app.root);app.start()}})}else return $.remove(content.querySelector("#demo"));this.lang&&this.lang.translate()},reviews:async()=>{this.routing&&this.routing.set("reviews");$.setContent(content,$.html(this.html.reviews));let results;if(this.rating_result)results=await this.rating_result.start({root:content.querySelector("#results .content"),"data.key":dataset.key});else $.remove(content.querySelector("#results"));if(this.rating)this.rating.start({root:content.querySelector("#rating .content"),"data.key":dataset.key,onchange:results.start});else $.remove(content.querySelector("#rating"));this.lang&&this.lang.translate()},creation:async()=>{this.routing&&this.routing.set("creation");if((!dataset.ignore.builders||!dataset.ignore.builders.length)&&!this.ignore.builder)return $.setContent(content,"");let config=this.ignore.create_similar_app||{key:"app"};delete this.ignore.create_similar_app;$.setContent(content,$.html(this.html.collection,{caption:"Choose Builder"}));const entries=dataset.ignore.builders.map(builder=>builder.title);this.ignore.builder&&entries.push("Default Builder");this.menu_app.start({root:content.querySelector("#menu-app"),data:{entries:entries},"routing.2":this.routing&&this.menu_app.config.routing&&this.routing.app&&{app:this.routing.app+"_builder"},onchange:event=>{const builder=dataset.ignore.builders[event.id-1];renderBuilder.call(this,builder?builder.app:this.ignore.builder)}});$.remove(content.querySelector("#menu-below"));async function renderBuilder(builder){this.builder.start({root:content.querySelector("#app"),data:{store:this.ignore.configs,key:["ccm.get",{local:{app:config}},"app"]},app:["ccm.component",dataset.path,config],builder:builder,"ignore.defaults":(await this.ccm.component(dataset.path)).config,onchange:(instance,event)=>{if(event!=="change")return;const value=instance.getValue();if(config)value.key=config.key;config=value}})}}};const menu=await this.menu_top.start({root:this.element.querySelector("#menu-top"),onchange:event=>view[event.id](),selected:this.ignore&&this.ignore.create_similar_app?"creation":this.routing&&this.routing.get()?null:undefined});this.onstart&&await this.onstart(this);this.lang&&this.lang.translate();this.routing&&this.routing.define({overview:()=>menu.select("overview"),reviews:()=>menu.select("reviews"),creation:()=>menu.select("creation")})})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();