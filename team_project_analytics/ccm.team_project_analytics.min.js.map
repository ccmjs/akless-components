{"version":3,"sources":["ccm.team_project_analytics.js"],"names":["component","name","ccm","config","chart","css","helper","html","project","Instance","$","dataset","this","start","async","Object","assign","use","datasets","data","store","get","_id","$regex","key","source","boards","cards","messages","forEach","entry","endsWith","teambuild","split","includes","push","chat","setContent","element","main","querySelector","loading","board","i","tools","length","app","instance","teams","lanes","clone","priorities","team","keys","members","map","member","user","message","card","lane","getLane","priority","indexOf","owner","render","table","getValue","j","b","version","join","window","files","components","url","c","match","a","document","createElement","head","appendChild","integrity","setAttribute","crossorigin","onload","removeChild","src"],"mappings":"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","sourcesContent":["/**\n * @overview ccmjs-based web component for team project analytics\n * @author Andr√© Kless <andre.kless@web.de> 2021\n * @license The MIT License (MIT)\n * @version latest (2.0.0)\n * @changes\n * version 2.0.0 (12.03.2021)\n * - compatible with ccm.team_project.js v3\n * - uses ccmjs v26.2.0 as default\n * version 1.0.0 (08.03.2021)\n */\n\n( () => {\n\n  const component = {\n    name: 'team_project_analytics',\n    ccm: 'https://ccmjs.github.io/ccm/ccm.min.js',\n    config: {\n      \"chart\": [ \"ccm.component\", \"https://ccmjs.github.io/akless-components/highchart/versions/ccm.highchart-3.0.3.min.js\" ],\n      \"css\": [ \"ccm.load\",\n        [  // serial\n          \"https://ccmjs.github.io/akless-components/libs/bootstrap-4/css/bootstrap.min.css\",\n          \"https://ccmjs.github.io/akless-components/team_project_analytics/resources/default.css\"\n        ]\n      ],\n      \"helper\": [ \"ccm.load\", \"https://ccmjs.github.io/akless-components/modules/versions/helper-7.0.0.mjs\" ],\n      \"html\": [ \"ccm.load\", \"https://ccmjs.github.io/akless-components/team_project_analytics/resources/templates.mjs\" ],\n      \"project\": [ \"ccm.instance\", \"https://ccmjs.github.io/akless-components/team_project/versions/ccm.team_project-3.0.0.min.js\" ]\n    },\n\n    Instance: function () {\n\n      let $, dataset;\n\n      this.start = async () => {\n\n        // set shortcut to help functions\n        $ = Object.assign( {}, this.ccm.helper, this.helper ); $.use( this.ccm );\n\n        // load all project-related datasets\n        const datasets = await this.project.data.store.get( { _id: { $regex: '^' + this.project.data.key + '-' } } );\n\n        // separate datasets by type\n        const source = { boards: {}, cards: [], messages: [] };\n        datasets.forEach( entry => {\n               if ( entry.key.endsWith( '-teams' ) ) source.teambuild = entry;\n          else if ( entry.key.endsWith( '-board' ) ) source.boards[ entry.key.split( '-' )[ 2 ] ] = entry;\n          else if ( entry.key.includes( '-card-' ) ) source.cards   .push( entry );\n          else if ( entry.chat                     ) source.messages.push( entry );\n        } );\n\n        // render main HTML structure\n        $.setContent( this.element, $.html( this.html.main, () => { $.setContent( this.element.querySelector( '#refresh' ), $.loading( this ) ); this.start(); } ) );\n\n        // no team building dataset? => nothing to display\n        if ( !source.teambuild ) return $.setContent( this.element.querySelector( '#data' ), '<span class=\"p-3\">This project has currently no teams.</span>' );\n\n        // get kanban board instance (not team-specific)\n        let board;\n        for ( let i = 0; i < this.project.tools.length; i++ )\n          if ( this.project.tools[ i ].key === 'board' )\n            board = await this.project.tools[ i ].app.instance();\n\n        // determine analytics data\n        dataset = {\n          teams: {},\n          lanes: $.clone( board.lanes ),\n          priorities: $.clone( board.priorities )\n        };\n        source.teambuild.teams.forEach( team => {\n          if ( !Object.keys( team.members ).length ) return;\n          dataset.teams[ team.key ] = {\n            key: team.key,\n            name: team.name,\n            messages: 0,\n            cards: 0,\n            members: {},\n            lanes: dataset.lanes.map( () => 0 ),\n            priorities: dataset.priorities.map( () => 0 )\n          };\n          Object.keys( team.members ).forEach( member => dataset.teams[ team.key ].members[ member ] = {\n            user: member,\n            name: team.members[ member ],\n            messages: 0,\n            cards: 0,\n            lanes: dataset.lanes.map( () => 0 ),\n            priorities: dataset.priorities.map( () => 0 )\n          } );\n        } );\n        source.messages.forEach( message => {\n          const team = dataset.teams[ message.chat.split( '-' )[ 2 ] ];\n          if ( !team ) return;\n          team.messages++;\n          team.members[ message.user ] && team.members[ message.user ].messages++;\n        } );\n        source.cards.forEach( card => {\n          const team = dataset.teams[ card.key.split( '-' )[ 2 ] ];\n          if ( !team ) return;\n          const lane = getLane( source.boards[ team.key ], card );\n          const priority = dataset.priorities.indexOf( card.priority ) + 1;\n          const member = team.members[ card.owner ];\n          team.cards++;\n          lane && team.lanes[ lane - 1 ]++;\n          priority && team.priorities[ priority - 1 ]++;\n          if ( !member ) return;\n          team.members[ card.owner ].cards++;\n          lane && team.members[ card.owner ].lanes[ lane - 1 ]++;\n          priority && team.members[ card.owner ].priorities[ priority - 1 ]++;\n        } );\n\n        // render analytics data\n        this.html.render( this.html.table( dataset ), this.element.querySelector( '#data' ) );\n\n      };\n\n      /**\n       * returns current result data\n       * @returns {Object}\n       */\n      this.getValue = () => $.clone( dataset );\n\n      /**\n       * get lane number of a card\n       * @param {Object} board - kanban board data\n       * @param {Object} card - kanban card data\n       * @returns {number} card number (0: not found)\n       */\n      const getLane = ( board, card ) => {\n        for ( let i = 0; i < board.lanes.length; i++ )\n          for ( let j = 0; j < board.lanes[ i ].cards.length; j++ )\n            if ( board.lanes[ i ].cards[ j ][ 2 ].data.key === card.key )\n              return i + 1;\n        return 0;\n      };\n\n    }\n  };\n\n  let b=\"ccm.\"+component.name+(component.version?\"-\"+component.version.join(\".\"):\"\")+\".js\";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);\"string\"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)/)||[\"\"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement(\"script\");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute(\"integrity\",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute(\"crossorigin\",component.ccm.crossorigin);a.onload=function(){(c=\"latest\"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}\n} )();"]}