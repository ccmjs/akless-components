(()=>{const component={name:"dms_analytics",ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.4.0.js",config:{apps:["ccm.store"],components:["ccm.store"],css:["ccm.load","https://ccmjs.github.io/akless-components/dms_analytics/resources/styles.css"],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-5.0.0.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/dms_analytics/resources/templates.html"],menu:["ccm.component","https://ccmjs.github.io/akless-components/menu/versions/ccm.menu-3.0.0.js",["ccm.get","https://ccmjs.github.io/akless-components/dms_analytics/resources/configs.js","menu"]]},Instance:function(){let $,apps,components;this.ready=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);this.logger&&this.logger.log("ready",$.privatize(this,true));apps=await this.ccm.store(await this.apps.get());components=await this.ccm.store(await this.components.get());this.apps.onchange=(async()=>{apps=await this.ccm.store(await this.apps.get());this.start()});this.components.onchange=(async()=>{components=await this.ccm.store(await this.components.get());this.start()})});this.start=(async()=>{$.setContent(this.element,$.loading(this));this.logger&&this.logger.log("start");const main_elem=$.html(this.html.main,this.start);const content=main_elem.querySelector("#content");const view={apps:async()=>{if(!this.chart)return;this.routing&&this.routing.set("apps");$.setContent(content,$.loading());let data={},total=0;await $.asyncForEach(await apps.get(),async app=>{const component_index=$.convertComponentURL(app.path).index;const component_name=component_index.split("-").shift();if(!data[component_name]){const component_meta=await components.get(component_index);if(component_meta)data[component_name]={name:component_meta.title,y:1}}else data[component_name].y++;total++});data=Object.values(data);if(data.length){const max=data.reduce((total,value)=>value.y>total.y?value:total);max.sliced=true;max.selected=true}await this.chart.start({root:content,settings:{chart:{type:"pie"},title:{text:"Total: "+total+" Apps"},subtitle:{text:"This Diagram shows how many Apps were created with which Component."},tooltip:{pointFormat:"<b>{point.y}</b> Apps were created with this Component."},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.y}"}}},series:[{data:data}]}})},components:async()=>{if(!this.chart)return;this.routing&&this.routing.set("components");$.setContent(content,$.loading());const filtered=await this.ccm.store(await components.get());await $.asyncForEach(await filtered.get(),async component=>{let highest=component;const results=await filtered.get({identifier:component.identifier});results.forEach(result=>{const compare=$.compareVersions(result.version,highest.version);compare>0&&filtered.del(highest.key);compare<0&&filtered.del(result.key)})});let data={},total=0;await $.asyncForEach(await filtered.get(),async component=>{if(!data[component.category])data[component.category]={name:component.category||"Without Category",y:1};else data[component.category].y++;total++});data=Object.values(data);await this.chart.start({root:content,settings:{title:{text:`Total:<br>${total} Components`,verticalAlign:"middle",y:40},subtitle:{text:"This Diagram shows how many Components were published under which Category.",y:-70,verticalAlign:"bottom"},tooltip:{pointFormat:"{point.y} Components have been published under this Category."},plotOptions:{pie:{dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.y}"},startAngle:-90,endAngle:90,center:["50%","75%"],size:"110%"}},series:[{type:"pie",innerSize:"50%",data:data}]}})},app_creators:async()=>{if(!this.chart)return;this.routing&&this.routing.set("app_creators");$.setContent(content,$.loading());let data={},total=0;await $.asyncForEach(await apps.get(),async app=>{const creator=app._.creator;if(!data[creator])data[creator]={name:app.creator,y:1};else data[creator].y++;total++});data=Object.values(data);data.sort((a,b)=>{a=a.name.toLowerCase();b=b.name.toLowerCase();return a<b?-1:a>b?1:0});const users=data.map(value=>value.name);await this.chart.start({root:content,settings:{chart:{type:"bar"},title:{text:`<b>${users.length} App Creators</b> have created <b>${total} Apps</b>`},xAxis:{categories:users},yAxis:{allowDecimals:false,min:0,title:{text:null}},tooltip:{pointFormat:"<b>{point.y}</b> Apps were created by this App Creator."},plotOptions:{bar:{dataLabels:{enabled:true}}},series:[{name:"Created Apps",data:data}]}})},component_developers:async()=>{if(!this.chart)return;this.routing&&this.routing.set("component_developers");$.setContent(content,$.loading());const filtered=await this.ccm.store(await components.get());await $.asyncForEach(await filtered.get(),async component=>{let highest=component;const results=await filtered.get({identifier:component.identifier});results.forEach(result=>{const compare=$.compareVersions(result.version,highest.version);compare>0&&filtered.del(highest.key);compare<0&&filtered.del(result.key)})});let data={},total=0;await $.asyncForEach(await filtered.get(),async component=>{const creator=component._.creator;if(!data[creator])data[creator]={name:component.creator,y:1};else data[creator].y++;total++});data=Object.values(data);data.sort((a,b)=>{a=a.name.toLowerCase();b=b.name.toLowerCase();return a<b?-1:a>b?1:0});const users=data.map(value=>value.name);await this.chart.start({root:content,settings:{chart:{type:"bar"},title:{text:`<b>${users.length} Component Developers</b> have published <b>${total} Components</b>`},xAxis:{categories:users},yAxis:{allowDecimals:false,min:0,title:{text:null}},tooltip:{pointFormat:"<b>{point.y}</b> Components were published by this Component Developer."},plotOptions:{bar:{dataLabels:{enabled:true}}},series:[{name:"Published Components",data:data}]}})}};const menu=await this.menu.start({root:main_elem.querySelector("#menu"),onchange:event=>view[event.id](),selected:this.routing&&this.routing.get()?null:undefined});!this.reload&&$.remove(main_elem.querySelector("#reload"));if(this.lang){$.append(main_elem.querySelector("#top"),this.lang.root);this.lang.start()}if(this.user){$.append(main_elem.querySelector("#top"),this.user.root);this.user.start()}$.setContent(this.element,main_elem);this.lang&&this.lang.translate();this.routing&&await this.routing.define({apps:()=>menu.select("apps"),components:()=>menu.select("components"),app_creators:()=>menu.select("app_creators"),component_developers:()=>menu.select("component_developers")})})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();