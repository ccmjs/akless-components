(function(){const component={name:"submit",version:[5,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-18.3.0.js",config:{html:{class:"section",inner:[{class:"items"},{class:"buttons",inner:[{tag:"a",class:"add btn btn-default btn-sm",role:"button",inner:{tag:"span",class:"glyphicon glyphicon-plus"},onclick:"%add%"},{tag:"a",class:"del btn btn-default btn-sm",role:"button",inner:{tag:"span",class:"glyphicon glyphicon-minus"},onclick:"%del%"}]}]},css:["ccm.load",{context:"head",url:"https://ccmjs.github.io/tkless-components/libs/bootstrap/css/font-face.css"},"https://ccmjs.github.io/tkless-components/libs/bootstrap/css/bootstrap.css"],data:{store:["ccm.store"]}},Instance:function(){const self=this;let $;let inputs;let element;this.ready=(async()=>{$=this.ccm.helper;this.submit=this.component;this.submit.config=$.integrate(JSON.parse(this.config),this.submit.config);this.logger&&this.logger.log("ready",$.privatize(this,true))});this.start=(async()=>{if(!this.inner)return;let dataset=await $.dataset(this.data);if(this.ignore)dataset=$.integrate(this.ignore.defaults,dataset,true);this.logger&&this.logger.log("start",$.clone(dataset));inputs=[];const inner=$.html(this.inner);await handleSeveral();await $.asyncForEach([...inner.querySelectorAll("input")],handleSpecials);$.fillForm(inner,dataset);[...inner.querySelectorAll("[name]")].forEach(elem=>elem.onchange=(event=>{const value=$.deepValue(this.getValue(),elem.name);this.logger&&this.logger.log("change",{name:elem.name,value:$.clone(value)});this.onchange&&this.onchange.call(this,{name:elem.name,value:$.clone(value),event:event})}));const content=this.content&&await this.content.start({inner:inner});$.setContent(this.element,content?content.root:inner);element=content?content.element:this.element;const submit=element.querySelector("input[type=submit]");if(!submit)return;const form=document.createElement("form");element.parentNode.replaceChild(form,element);form.appendChild(element);form.onsubmit=(async event=>{event.preventDefault();this.user&&await this.user.login();let results=this.getValue();this.logger&&this.logger.log("submit",$.clone(results));this.onfinish&&await $.onFinish(this,$.clone(results))});async function handleSeveral(){return $.asyncForEach([...inner.querySelectorAll("several")],async several=>{if(several.hasAttribute("name")){const input=$.html({tag:"input",type:"submit",name:several.getAttribute("name")});input.setAttribute("inner",several.innerHTML);$.setContent(several,input)}const template=$.html({class:"item"});while(several.childNodes.length)template.appendChild(several.childNodes[0]);const section=$.html(self.html,{add:addItem,del:delItem});$.replace(section,several);const name=template.querySelector("[name]").name;if(!dataset[name])return addItem();dataset[name].forEach((value,i)=>dataset[name+"."+i]=value);for(let i=0;i<dataset[name].length;i++)await addItem();delete dataset[name];async function addItem(){const items=section.querySelector(".items");const item=template.cloneNode(true);const input=item.querySelector("[name]");$.append(items,item);input.name=input.name+"."+(items.childElementCount-1);input.onchange=(event=>{const value=$.deepValue(self.getValue(),input.name);self.logger&&self.logger.log("change",{name:input.name,value:$.clone(value)});self.onchange&&self.onchange.call(self,{name:input.name,value:$.clone(value),event:event})});[...item.querySelectorAll("nr")].forEach(nr=>$.replace($.html({tag:"span",inner:items.childElementCount}),nr));await handleSpecials(input)}function delItem(){const items=section.querySelector(".items");items.childElementCount&&items.removeChild(items.lastChild)}})}async function handleSpecials(input){const type=input.getAttribute("type");switch(type){case"button":case"checkbox":case"color":case"date":case"datetime-local":case"email":case"file":case"hidden":case"image":case"month":case"number":case"password":case"radio":case"range":case"reset":case"search":case"tel":case"text":case"time":case"url":case"week":break;default:if(!self[type])return;if(type==="submit"&&!input.getAttribute("name"))return;const instance=await self[type].start({inner:input.getAttribute("inner")||undefined,data:{store:["ccm.store",{config:$.deepValue(dataset,input.name)}],key:"config"},onchange:function(){const value=this.getValue();delete value.key;self.logger&&self.logger.log("change",{name:input.name,value:$.clone(value),builder:instance});self.onchange&&self.onchange.call(self,{name:input.name,value:$.clone(value),builder:instance})}});$.replace(instance.root,input);inputs.push({instance:instance,name:input.name})}}});this.getValue=(()=>{let results=$.formData(element);inputs.forEach(input=>{const result=input.instance.getValue();delete result.key;$.deepValue(results,input.name,result)});return $.clone(results)})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();