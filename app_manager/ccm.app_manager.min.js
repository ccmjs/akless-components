(()=>{const component={name:"app_manager",ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.0.0.js",config:{css:["ccm.load","https://ccmjs.github.io/akless-components/app_manager/resources/styles.css"],data:{store:["ccm.store"]},helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-4.0.1.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/app_manager/resources/templates.html"]},Instance:function(){let $;this.init=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);if(this.user)this.user.onchange=this.start});this.ready=(async()=>{this.logger&&this.logger.log("ready",$.privatize(this,true))});this.start=(async()=>{const dataset=await $.dataset(this.data);if(!dataset||Object.keys(dataset).length<=1)return $.setContent(this.element,$.html(this.html.empty,"App"));if(!dataset.icon)dataset.icon=this.default_icon||"";this.logger&&this.logger.log("start",$.clone(dataset));$.setContent(this.element,$.html(this.html.main,await $.integrate($.clone(dataset),{fullscreen:()=>{$.fullscreen(this.element.querySelector("#app"));this.logger&&this.logger.log("fullscreen",{store:this.data.store.source(),key:dataset.key})},edit:async()=>{const main=this.element.querySelector("#main");$.setContent(this.element,$.html(this.html.edit,{cancel:()=>{$.setContent(this.element,main);this.logger&&this.logger.log("cancel",{store:this.data.store.source(),key:dataset.key})},del:()=>{if(!confirm("Are you sure? Metadata and configuration of the app will be deleted. The app will no longer work anywhere on the web."))return;this.data.store.del(dataset.key).then(async()=>{dataset.source[0].parent=this;await this.ccm.del.apply(null,dataset.source);this.logger&&this.logger.log("delete",{store:this.data.store.source(),dataset:$.clone(dataset)});await this.start();this.onchange&&this.onchange({event:"delete",instance:this,dataset:$.clone(dataset)})})}}));const form=await this.form.start({root:this.element.querySelector("#form"),data:{store:["ccm.store",this.data.store.source()],key:dataset.key},onfinish:{store:true,callback:async results=>{this.logger&&this.logger.log("update",{store:this.data.store.source(),dataset:results});await this.start();this.onchange&&this.onchange({event:"update",instance:this,dataset:results})}}});this.lang&&this.lang.translate();this.logger&&this.logger.log("edit",{store:this.data.store.source(),dataset:$.clone(dataset)});this.onchange&&this.onchange({event:"edit",instance:this,form:form,dataset:$.clone(dataset)})}})));if(!dataset.icon)$.remove(this.element.querySelector("#icon"));if(!dataset.abstract)$.remove(this.element.querySelector("#abstract"));if(!dataset.description)$.remove(this.element.querySelector("#description"));if(!this.user||!this.user.isLoggedIn()||this.user.data().user!==dataset._.creator||!this.form)$.remove(this.element.querySelector("#edit_button"));if(this.lang){$.append(this.element.querySelector("#top"),this.lang.root);this.lang.start()}if(this.user)$.append(this.element.querySelector("#top"),this.user.root);if(await this.ccm.get.apply(null,dataset.source))this.ccm.start(dataset.path,{key:["ccm.get",dataset.source[0],dataset.source[1]],parent:this,root:this.element.querySelector("#app .content")});else $.setContent(this.element.querySelector("#app .content"),$.html(this.html.empty,"App Configuration"));if(this.app_details)this.app_details.start({root:this.element.querySelector("#details .content"),json2json:json=>{json.category=json.category||"";if(json.language)json.language=json.language.filter(Boolean).join(", ").toUpperCase();json.tags=json.tags.join(", ");json.language=json.language||"";json.created_at=json.created_at?new Date(json.created_at).toLocaleString():"";json.component=$.convertComponentURL(json.path).index;return json},placeholder:$.clone(dataset)});else $.remove(this.element.querySelector("#details"));if(this.handover_app)this.handover_app.start({root:this.element.querySelector("#handover .content"),component_url:dataset.path,data:{store:["ccm.store",dataset.source[0]],key:dataset.source[1]}});else $.remove(this.element.querySelector("#handover"));this.onstart&&await this.onstart(this);this.lang&&this.lang.translate()})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){window.ccm[c].component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();