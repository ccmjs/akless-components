(()=>{const component={name:"cloze_builder",version:[4,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-26.1.0.js",config:{css:["ccm.load",["https://ccmjs.github.io/akless-components/libs/bootstrap-4/css/bootstrap.min.css","https://ccmjs.github.io/akless-components/cloze_builder/resources/default-1.css"]],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-6.0.0.mjs"],html:["ccm.load","https://ccmjs.github.io/akless-components/cloze_builder/resources/templates.mjs"],libs:["ccm.load","https://ccmjs.github.io/akless-components/libs/quill-1/quill.snow.css","https://ccmjs.github.io/akless-components/libs/selectize-0/selectize.css",["https://ccmjs.github.io/akless-components/libs/jquery/jquery-3.5.1.slim.min.js",["https://ccmjs.github.io/akless-components/libs/quill-1/quill.min.js","https://ccmjs.github.io/akless-components/libs/bootstrap-4/js/bootstrap.bundle.min.js",["https://ccmjs.github.io/akless-components/libs/selectize-0/selectize.min.js","https://ccmjs.github.io/akless-components/libs/selectize-0/selectize-plugin.min.js"]]]],preview:"Preview",results:{store:{name:"cloze_results"},permissions:{access:{get:"all",set:"creator",del:"creator"}}},submit:"Submit",tool:["ccm.component","https://ccmjs.github.io/akless-components/cloze/versions/ccm.cloze-8.0.0.min.js"],ignore:{guest:["ccm.instance","https://ccmjs.github.io/akless-components/user/versions/ccm.user-9.7.0.js",["ccm.get","https://ccmjs.github.io/akless-components/user/resources/resources.js","guest"]],cloud:["ccm.instance","https://ccmjs.github.io/akless-components/user/versions/ccm.user-9.7.0.js",["ccm.get","https://ccmjs.github.io/akless-components/user/resources/resources.js","cloud"]],hbrsinfkaul:["ccm.instance","https://ccmjs.github.io/akless-components/user/versions/ccm.user-9.7.0.js",["ccm.get","https://ccmjs.github.io/akless-components/user/resources/resources.js","hbrsinfkaul"]],hbrsinfpseudo:["ccm.instance","https://ccmjs.github.io/akless-components/user/versions/ccm.user-9.7.0.js",["ccm.get","https://ccmjs.github.io/akless-components/user/resources/resources.js","hbrsinfpseudo"]],pseudo:["ccm.instance","https://ccmjs.github.io/akless-components/user/versions/ccm.user-9.7.0.js",["ccm.get","https://ccmjs.github.io/akless-components/user/resources/resources.js","pseudo"]]}},Instance:function(){let $,editor;this.ready=(async()=>{$=Object.assign({},this.ccm.helper,this.helper);$.use(this.ccm);delete this.tool.config.parent;this.logger&&this.logger.log("ready",$.privatize(this,true))});this.start=(async()=>{const dataset=await $.integrate(await $.dataset(this.data),this.tool.config);this.logger&&this.logger.log("start",$.clone(dataset));this.render(dataset);this.element.querySelector("#editor").innerHTML=dataset.text||"";editor=new Quill("#editor",{placeholder:"Write here...",theme:"snow"});jQuery(this.element.querySelector("#cb-tags")).selectize({create:true,placeholder:"Individual List of Provided Answers",plugins:["remove_button"]});this.element.querySelectorAll("*[name]").forEach(input=>input.addEventListener("change",()=>this.render()));jQuery("#cb-preview").on("show.bs.modal",()=>this.tool.start(Object.assign(this.getValue(),{root:this.element.querySelector("#cb-preview-body")})));this.submit&&this.element.querySelector("form").addEventListener("submit",event=>{event.preventDefault();const result_data=this.getValue();this.logger&&this.logger.log("finish",$.clone(result_data));$.onFinish(this,result_data)})});this.render=((config=this.getValue())=>{$.render($.html(this.html.main,config,this),this.element)});this.getValue=(()=>{const config=$.formData(this.element);config.text=editor&&editor.root.innerHTML;if(config.keywords==="manually")config.keywords=config.tags;delete config.tags;if(!config.reset)config.onreset=false;else delete config.reset;if(!config.finish)delete config.onfinish;delete config.finish;if(!config.onfinish)return config;const key=this.results.key||$.generateKey();switch(config.store){case"collective":config.onfinish.store=true;config.data={store:this.results,key:key};break;case"user":config.onfinish.store=true;config.data={store:this.results,key:key,login:true,user:true,permissions:this.results.permissions};break;case"unique":config.onfinish.login=true;config.onfinish.store={settings:this.results,key:key,login:true,user:true,unique:true,permissions:this.results.permissions};break}if(!config.store||config.store==="collective")delete config.user;delete config.store;if(config.user)config.user=this.ignore[config.user];switch(config.render){case"clear":config.onfinish.clear=true;break;case"restart":config.onfinish.restart=true;break;case"app":config.onfinish.render=config.app&&$.decomposeEmbedCode(config.app)||{};break}delete config.render;delete config.app;return config})}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||[""])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){(c="latest"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();